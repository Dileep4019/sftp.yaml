---
- name: Download and Configure Minio Client
  hosts: 10.10.5.182
  gather_facts: no

  tasks:
    - name: Download Minio Client
      get_url:
        url: "https://dl.min.io/client/mc/release/windows-amd64/mc.exe"
        dest: "C:\\Users\\"
      register: download_result
      ignore_errors: yes

    - name: Verify Download
      fail:
        msg: "Failed to download Minio Client"
      when: download_result.failed

    - name: Set Environment Variables
      environment:
        PATH: "C:\\Users\\"
        
    - name: Configure Minio Client
      command: "C:\\mc.exe config host add minio {{ minio_server_url }} {{ minio_access_key }} {{ minio_secret_key }}"
      vars:
        minio_server_url: "https://10.10.5.182:9000"
        minio_access_key: "minioadmin"
        minio_secret_key: "minio_admin"

    - name: Download an Object from Minio
      command: "C:\\Users\\ cp minio/arc/Arc_11102023 C:\\Users\\"
      vars:
        minio_bucket_name: "arc"
      when: download_result.changed
